---
layout: default
permalink: /desarrollo/spree.html
---

# Spree

## Enlaces

*  [Getting Started with Spree](http://railscasts.com/episodes/298-getting-started-with-spree)
*  [Spree 1.1 Deployment on Heroku](http://ruby-journal.com/spree-1-1-stable-deployment-on-heroku/)
*  [How To: Add A Custom Model to Your Spree App](http://quickleft.com/blog/how-to-add-a-custom-model-to-your-spree-app)
*  [The Spree API Documentation](http://api.spreecommerce.com/) :exclamation:
*  [How to Optimize Your Spree Store for Search Engines](http://spreecommerce.com/blog/how-to-optimize-your-spree-store-for-search-engines)
*  [Crear extensión Spree](http://rvalle.es/crear-extension-spree/)
*  [Tracking E-commerce With Google Analytics](http://spreecommerce.com/blog/ecommerce-tracking-in-spree) :exclamation:

## Hilos interesantes Google Group

*  [Add custom admin controller and use custom code inside controller](https://groups.google.com/forum/?fromgroups=#!topic/spree-user/hZM2vYeBjXA)
*  [Do something when state order change to completed](https://groups.google.com/forum/?fromgroups=#!topic/spree-user/Y7xG23yz53w)
*  [Changing /products path and linking to individual products](https://groups.google.com/forum/?fromgroups=#!topic/spree-user/sCo6yycKyjk)
*  [Upgrading Extensions to Spree 2](https://groups.google.com/forum/?fromgroups#!topic/spree-user/q05nXaxjK14)
*  [Rich text in product description](https://groups.google.com/forum/?fromgroups#!topic/spree-user/B7wHm-xUZ-Y/vjQ2YpeS2jgJ): Instalación de CKEditor para que se use en todos los texarea de la administración de Spree.
*  [Remove /t/ from uri](https://groups.google.com/forum/#!topic/spree-user/reB9QRkNkxU)

## Extensiones interesantes

*  [Static Content](http://spreecommerce.com/extensions/139-static-content): Content management of static pages for Spree. Para páginas como About, Términos legales, etc. (en [Github](https://github.com/spree/spree_static_content)) :exclamation:
*  [Related Products](http://spreecommerce.com/extensions/89-related-products): This extension provides a generic way for you to define different types of relationships between your products, by defining a RelationType for each type of relationship you’d like to maintain. (en [Github](http://github.com/spree/spree_related_products)) :exclamation:
*  [Spree Variant Options](http://spreecommerce.com/extensions/170-spree-variant-options): Spree Variant Options replaces the radio-button variant selection with groups of option types and values. (en [Github](https://github.com/citrus/spree_variant_options)) :exclamation:
*  [SpreeEditor](https://github.com/spree/spree_editor): This extension provides an inline rich-text editor for Spree.
*  [Spree Simple Blog](https://github.com/spree/spree-simple-blog): Adds a simple blog to Spree which works much like [Toto](http://github.com/cloudhead/toto/).
*  [Spree Reviews](https://github.com/spree/spree_reviews): Straightforward review/rating facility.
*  [Spree Wishlist](https://github.com/spree/spree_wishlist): The Spree Wishlist extension enables multiple wishlists per user, as well as managing those as public (sharable) and private. It also includes the ability to notify a friend via email of a recommended product. :exclamation:
*  [Spree Email to Friend](https://github.com/spree/spree_email_to_friend): The Spree Email to Friend extension enables you to send the product reference to your friend via email. :exclamation:
*  [Google Checkout](https://github.com/railsdog/spree-google-checkout): Users can place order through Google Checkout.
*  [Spree Sitemaps](https://github.com/stephskardal/spree-sitemaps): This extension creates sitemaps in .html, .txt, and .xml (google sitemap) formats.
*  [Spree_Videos](http://spreecommerce.com/extensions/198-spree_videos): Display YouTube video(s) on your product page. (en [Github](https://github.com/iloveitaly/Spree-Videos))
*  [SpreeProductZoom](http://spreecommerce.com/extensions/267-spree_product_zoom): A Spree extension that adds lightbox zoom functionality for product images powered by [fancyBox](http://fancyapps.com/fancybox/). (en [Github](https://github.com/spree/spree_product_zoom))
*  [Sitemap Generator](http://spreecommerce.com/extensions/187-sitemap-generator): Spree sitemap generator is a sitemap generator based on the [sitemap_generator](http://github.com/kjvarga/sitemap_generator) gem. It adheres to the Sitemap 0.9 protocol specification. (en [Github](https://github.com/joshnuss/spree-sitemap-generator))
*  [Spree Google Merchant](http://spreecommerce.com/extensions/172-spree-google-merchant): This extension provides a product feed for Google Merchant rather than a file that you have to upload. (en [Github](https://github.com/sebastyuiop/spree_google_merchant))
*  [spree-magiczoomplus](http://spreecommerce.com/extensions/136-spree-magiczoomplus): Adds [MagicZoomPlus](http://www.magictoolbox.com/magiczoomplus/) to Spree store. (en [Github](https://github.com/hnprashanth/spree-magiczoomplus))
*  [Spree Social Bookmarks](http://spreecommerce.com/extensions/87-spree-social-bookmarks): This extension allows you to add social bookmarking to your products so your customers can share pages. (en [Github](https://github.com/WSMedia/Spree-Social-Bookmarks))
*  [Spree Volume Pricing](http://spreecommerce.com/extensions/2-volume-pricing): This extension uses predefined ranges of quantities to determine the price for a particular product variant. (en [Github](https://github.com/spree/spree_volume_pricing))
*  [Active Shipping](http://spreecommerce.com/extensions/3-active-shipping): Spree calculator that interfaces with USPS, UPS and FedEx via the popular active_shipping plugin. (en [Github](https://github.com/Shopify/active_shipping))
*  [Payment Methods With Range](http://spreecommerce.com/extensions/78-payment-methods-with-range): This extensions allow declaring payment methods only available for a certain order amount. (en [Github](https://github.com/jpl/spree-payment-methods-with-range))
*  [Print Invoice](http://spreecommerce.com/extensions/29-print-invoice): Generación de facturas en PDF en el backend. (en [Github](https://github.com/spree/spree_print_invoice))
*  [Product Assembly](https://github.com/spree/spree-product-assembly): Create a product which is composed of other products.
*  [SpreeBootstrap](https://github.com/jdutil/spree_bootstrap): This project aims to replace the spree_frontend's use of the skeleton css framework in favor of Twitter Bootstrap.
*  [SpreeContactUs](https://github.com/jdutil/spree_contact_us): A Rails 3+ Engine providing a basic contact form as a Spree Extension.

## Instalación en Ubuntu

A los paquetes necesarios para la instalación de [Rails](/desarrollo/ror.html) hay que añadir:

*  `libxml2-dev`
*  `libxslt1-dev`
*  `git`

## Tips

### Override de preferencias

Crear el fichero `config/initializers/spree_config.rb` y hacer un set de las propiedades. Por ejemplo:

```ruby
#encoding: utf-8
Spree::Config.set(logo: "store/myapp_logo.png")
Spree::Config.set(site_name: 'MyApp')
Spree::Config.set(currency: 'EUR')
Spree::Config.set(currency_symbol_position: 'after')
Spree::Config.set(default_meta_description: 'MyApp')
Spree::Config.set(default_meta_keywords: 'mis palabras clave')
```

Todas las preferencias posibles están definidas en el fichero `core/app/models/spree/app_configuration.rb`.

Las preferencias ajustadas de esta forma acaban en la base de datos en la tabla `spree_preferences`. Si se quita alguna de las lineas anteriores, hay que eliminar el registro correspondiente para que deje de hacer efecto. En ocasiones no es suficiente con esto, ya que también puede influir el hecho de que algunas queries son cacheadas. En ese caso hay que borrar el directorio `tmp/cache`.

### Actualización de versión

Cuando aparezca una nueva versión de Spree y se quiera actualizar hay que proceder como sigue:

```bash
$ bundle update spree
$ bundle exec rake railties:install:migrations
$ bundle exec rake db:migrate
```

### Tareas "rake"

*  `bundle exec rake assets:precompile:nondigest`: Mejora el rendimiento en el entorno de desarrollo a costa de no refrescar en tiempo real los cambios en los assets.
*  `bundle exec rake assets:clean`: Borra el directorio `public/assets`.
*  `bundle exec rake assets:precompile`: Reconstruye el directorio `public/assets`. 
*  `bundle exec rake spree_auth:admin:create`: Crea un usuario administrador.
*  `bundle exec rake spree_sample:load`: Cargar los datos de ejemplo. Exige ejecutar previamente `bundle exec rake db:seed`

### Instalación de versión 2.0

El instalador de las últimas versiones no es del todo redondo (al menos en el momento de escribir esto) y da algunos errores. Para superarlos hay que proceder como sigue.

Ejecutar en consola lo siguiente:

```bash
$ rails new spapp
```

Modificamos la linea de la gem `jquery-rails` poniendo:

	gem 'jquery-rails', '~> 2.2.1'

Ejecutamos:

```bash
$ cd spapp
$ spree install
```

Decimos "yes" a todas las preguntas. Cuando termine volvemos a modificar Gemfile sustituyendo las versiones de las gems de Spree que ha añadido el script por las siguientes:

	gem 'spree', :github => 'spree/spree', :branch => '2-0-stable'
	gem 'spree_gateway', :github => 'spree/spree_gateway', :branch => '2-0-stable'
	gem 'spree_auth_devise', :github => 'spree/spree_auth_devise', :branch => '2-0-stable'

Finalmente de nuevo ejecutamos:

```bash
$ bundle install
```

### Configuración para enviar correos

Hay dos formas:

 1.  Configurando directamente el ActionMailer por código
 2.  Usando el override que permite configurar el ActionMailer en el backend

Para el primer tipo empezamos poniendo las siguientes preferencias en el fichero `config/initializers/spree.rb`:

```ruby
config.override_actionmailer_config = false
config.mails_from = "origen@mail.com"
```

Luego añadimos lo siguiente en el fichero de configuración del entorno, por ejemplo en development sería `config/environments/development.rb`:

```ruby
config.action_mailer.delivery_method = :smtp
config.action_mailer.smtp_settings = {
  address:              'smtp.gmail.com',
  port:                 587,
  domain:               'gmail.com',
  user_name:            'user_id',  # No es necesario poner @gmail.com
  password:             'password',
  authentication:       'plain',
  enable_starttls_auto: true  }
```

En teoría con esto sería suficiente, pero en las primeras pruebas hechas, sólo funcionó con la versión 2.5.3 de la gem `mail`, por lo que hubo que especificarla en el Gemfile:

```ruby
gem 'mail', '2.5.3'
```

La última versión de `mail` es la 2.5.4 que será la que normalmente esté instalada. Para hacer el downgrade hay que ejecutar desde el directorio de nuestro proyecto:

```bash
$ bundle update mail
```

En posteriores versiones de las gemas ya funcionaba con la versión 2.5.4 de `mail` por lo que dejó de ser necesario hacer este apaño.

Para el segundo tipo de configuración empezamos poniendo las siguientes preferencias en el fichero `config/initializers/spree.rb`:

```ruby
config.override_actionmailer_config = true
config.mails_from = "origen@mail.com"
```

Como siempre que se tocan las preferencias, hay que vigilar si ya existe versión de la misma en la tabla `spree_preferences` y si está la consulta a esta tabla cacheada, por lo que habrá que borrar el directorio `tmp/cache`.

Luego deberemos acudir en el backend a la siguiente ruta: "Configuraciones / Preferencias métodos de email". Hay que tener en cuenta que este grupo de opciones sólo aparece si la opción `override_actionmailer_config` tiene el valor true. A continuación se muestran pantallazos de un par de configuraciones que se ha probado que funcionan:

![Conf con GMail](/images/pages/conf_gmail.png "Configuración con GMail")

![Conf con DH](/images/pages/conf_dh.png "Configuración con DinaHosting")

### Configuración según entorno

Si queremos ajustar algunas preferencias en el initializer `config/initializers/spree.rb` de manera que su valor dependa del environment, podemos hacer lo siguiente:

```ruby
Spree.config do |config|
  if Rails.env.production?
    config.mail_port = 1025
    # other configs ..
  else
    config.mail_port = 25
    # other configs ..
  end
end
```

### Resetear base de datos

Si queremos comenzar de nuevo en lo que respecta a la base de datos, se puede hacer fácilmente con el siguiente comando:

```bash
$ bundle exec rake db:reset
```

A nivel de ficheros habrá que hacer la limpieza a mano. En el Spree básico, como mínimo habría que borrar el directorio `rails_root/public/spree/products`.
